---
import BaseLayout from '../../layouts/BaseLayout.astro';
import HeroSection from '../../components/HeroSection.astro';
import Card from '../../components/Card.astro';
import InteractiveButton from '../../components/InteractiveButton.astro';
import { getCollection } from 'astro:content';

const blogPosts = await getCollection('blog');
const sortedPosts = blogPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
const featuredPosts = sortedPosts.filter(post => post.data.featured);
const regularPosts = sortedPosts.filter(post => !post.data.featured);

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}
---

<BaseLayout
  title="Blog | Breath of Life Ministries"
  description="Read our latest articles on mental health, suicide prevention, faith, and hope from a Catholic perspective."
>
  <HeroSection
    title="Blog & Articles"
    subtitle="Insights on mental health, faith, and hope"
    useVideo={false}
    height="medium"
  />

  <!-- Featured Posts -->
  {featuredPosts.length > 0 && (
    <section class="gradient-bg">
      <div class="container">
        <h2 class="text-center text-gradient">Featured Articles</h2>
        <div class="featured-grid">
          {featuredPosts.map((post) => (
            <article class="featured-post">
              {post.data.image && (
                <div class="featured-image">
                  <img src={post.data.image} alt={post.data.title} />
                </div>
              )}
              <div class="featured-content">
                <div class="featured-meta">
                  <span class="featured-date">{formatDate(post.data.pubDate)}</span>
                  {post.data.tags.length > 0 && (
                    <div class="featured-tags">
                      {post.data.tags.slice(0, 3).map(tag => (
                        <span class="tag">{tag}</span>
                      ))}
                    </div>
                  )}
                </div>
                <h3 class="featured-title">{post.data.title}</h3>
                <p class="featured-description">{post.data.description}</p>
                <InteractiveButton href={`/blog/${post.slug}`} variant="primary">
                  Read Article
                </InteractiveButton>
              </div>
            </article>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- All Posts -->
  <section class={featuredPosts.length > 0 ? 'alt-bg' : ''}>
    <div class="container">
      <h2 class="text-center text-gradient">All Articles</h2>
      <div class="blog-grid">
        {regularPosts.map((post) => (
          <article class="blog-card">
            {post.data.image && (
              <div class="blog-card-image">
                <img src={post.data.image} alt={post.data.title} />
              </div>
            )}
            <div class="blog-card-content">
              <div class="blog-card-meta">
                <span class="blog-card-date">{formatDate(post.data.pubDate)}</span>
                <span class="blog-card-author">{post.data.author}</span>
              </div>
              <h3 class="blog-card-title">
                <a href={`/blog/${post.slug}`}>{post.data.title}</a>
              </h3>
              <p class="blog-card-description">{post.data.description}</p>
              {post.data.tags.length > 0 && (
                <div class="blog-card-tags">
                  {post.data.tags.slice(0, 3).map(tag => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              )}
              <a href={`/blog/${post.slug}`} class="read-more">Read More â†’</a>
            </div>
          </article>
        ))}
      </div>

      {regularPosts.length === 0 && featuredPosts.length === 0 && (
        <div class="no-posts">
          <p>No blog posts available yet. Check back soon!</p>
        </div>
      )}
    </div>
  </section>

  <!-- Call to Action -->
  <section class="gradient-bg">
    <div class="container-narrow">
      <div class="cta-box">
        <h2 class="text-gradient">Need Support?</h2>
        <p class="lead">If you or someone you know is struggling, help is available.</p>
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 2rem;">
          <InteractiveButton href="/#get-help" variant="primary" size="large">
            Get Help Now
          </InteractiveButton>
          <InteractiveButton href="/resources" variant="outline" size="large">
            View Resources
          </InteractiveButton>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* Featured Posts */
  .featured-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .featured-post {
    background: white;
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-xl);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .featured-post:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  }

  .featured-image {
    width: 100%;
    height: 300px;
    overflow: hidden;
  }

  .featured-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .featured-post:hover .featured-image img {
    transform: scale(1.05);
  }

  .featured-content {
    padding: 2rem;
  }

  .featured-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .featured-date {
    color: var(--text-muted);
    font-size: 0.9rem;
  }

  .featured-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .featured-title {
    font-size: 1.75rem;
    margin-bottom: 1rem;
    color: var(--heading-color);
  }

  .featured-description {
    color: var(--text-color);
    line-height: 1.6;
    margin-bottom: 1.5rem;
  }

  /* Blog Grid */
  .blog-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .blog-card {
    background: white;
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    flex-direction: column;
  }

  .blog-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
  }

  .blog-card-image {
    width: 100%;
    height: 200px;
    overflow: hidden;
  }

  .blog-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .blog-card:hover .blog-card-image img {
    transform: scale(1.05);
  }

  .blog-card-content {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .blog-card-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    font-size: 0.85rem;
    color: var(--text-muted);
    flex-wrap: wrap;
  }

  .blog-card-title {
    font-size: 1.375rem;
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .blog-card-title a {
    color: var(--heading-color);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .blog-card-title a:hover {
    color: var(--primary-color);
  }

  .blog-card-description {
    color: var(--text-color);
    line-height: 1.6;
    margin-bottom: 1rem;
    flex: 1;
  }

  .blog-card-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 1rem;
  }

  .tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: var(--primary-light);
    color: var(--primary-dark);
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 600;
  }

  .read-more {
    color: var(--primary-color);
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    transition: transform 0.3s ease;
  }

  .read-more:hover {
    transform: translateX(4px);
  }

  /* No Posts */
  .no-posts {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-muted);
  }

  /* CTA Box */
  .cta-box {
    text-align: center;
    padding: 2rem;
  }

  @media (max-width: 768px) {
    .featured-grid {
      grid-template-columns: 1fr;
    }

    .blog-grid {
      grid-template-columns: 1fr;
    }

    .featured-title {
      font-size: 1.5rem;
    }

    .blog-card-title {
      font-size: 1.25rem;
    }
  }
</style>
